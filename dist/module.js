define(["app/plugins/sdk","app/core/app_events"],function(e,t){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=438)}({17:function(e,t,n){"use strict";n.d(t,"c",function(){return o}),n.d(t,"a",function(){return s}),n.d(t,"b",function(){return i}),n.d(t,"d",function(){return u});
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function o(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var s=function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function i(e,t,n,r){return new(n||(n=Promise))(function(o,s){function i(e){try{a(r.next(e))}catch(e){s(e)}}function u(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(i,u)}a((r=r.apply(e,t||[])).next())})}function u(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}},32:function(t,n){t.exports=e},438:function(e,t,n){"use strict";n.r(t);var r=n(70);n.d(t,"ConfigCtrl",function(){return r.SensuConfigCtrl});var o=n(71);n.d(t,"SensuServersCtrl",function(){return o.SensuServersCtrl});var s=n(72);n.d(t,"SensuServerInfoCtrl",function(){return s.SensuServerInfoCtrl});var i=n(32);Object(i.loadPluginCss)({dark:"plugins/grafana-sensu-app/css/sensu-app.dark.css",light:"plugins/grafana-sensu-app/css/sensu-app.light.css"})},69:function(e,n){e.exports=t},70:function(e,t,n){"use strict";n.r(t),n.d(t,"SensuConfigCtrl",function(){return r});var r=function(){function e(e,t,n){this.$q=n,this.enabled=!1,this.appEditCtrl.setPostUpdateHook(this.postUpdate.bind(this))}return e.prototype.postUpdate=function(){var e=this;return this.appModel.enabled?this.appEditCtrl.importDashboards().then(function(){return e.enabled=!0,{url:"plugins/grafana-sensu-app/page/configure",message:"Sensu App enabled!"}}):this.$q.resolve()},e.templateUrl="components/config/config.html",e}()},71:function(e,t,n){"use strict";n.r(t),n.d(t,"SensuServersCtrl",function(){return i});var r=n(17),o=n(69),s=n.n(o),i=function(){function e(e,t,n,r,o){this.backendSrv=n,this.contextSrv=r,this.$location=o,this.isOrgEditor=r.hasRole("Editor")||r.hasRole("Admin"),document.title="Grafana Sensu App",this.servers=[],this.pageReady=!1,this.getSensuServers()}return e.prototype.getSensuServers=function(){return r.b(this,void 0,void 0,function(){var e;return r.d(this,function(t){return[2,(e=this).backendSrv.get("/api/datasources").then(function(t){e.servers=t.filter(function(e){return"grafana-sensucore-datasource"===e.type}),console.log("servers..."+JSON.stringify(e.servers)),e.pageReady=!0})]})})},e.prototype.confirmDelete=function(e){var t=this;this.backendSrv.delete("/api/datasources/"+e).then(function(){t.getSensuServers()})},e.prototype.deleteSensuServer=function(e){var t=this;s.a.emit("confirm-modal",{title:"Delete",text:"Are you sure you want to delete this data source?",yesText:"Delete",icon:"fa-trash",onConfirm:function(){t.confirmDelete(e.id)}})},e.prototype.addSensuServer=function(){return r.b(this,void 0,void 0,function(){var e,t,n;return r.d(this,function(r){switch(r.label){case 0:return e={name:"SensuAppCore-"+this.servers.length,type:"grafana-sensucore-datasource",access:"proxy",isDefault:!1},[4,this.backendSrv.post("/api/datasources",e)];case 1:return t=r.sent(),n=t.datasource.id,this.$location.url("/plugins/grafana-sensu-app/page/sensu-servers"),window.location.href="/datasources/edit/"+n,[2]}})})},e.prototype.serverInfo=function(e){this.$location.path("plugins/grafana-sensu-app/page/sensu-server-info").search({server:e.id})},e.templateUrl="components/servers/partials/servers.html",e}()},72:function(e,t,n){"use strict";n.r(t),n.d(t,"SensuServerInfoCtrl",function(){return o});var r=n(17),o=function(){function e(e,t,n,r,o,s,i){this.backendSrv=n,this.datasourceSrv=r,this.$q=o,this.$location=s,this.alertSrv=i,this.pageReady=!1,this.$q=o,this.$scope=e,document.title="Grafana Sensu App - Info",this.server={},"server"in s.search()?this.getSensuServerInfo(s.search().server):i.set("No Sensu server specified.","No Sensu server specified in url","error")}return e.prototype.getSensuServerInfo=function(e){var t=this;this.getSensuServer(e).then(function(e){t.serverDS=e,t.serverDS.getServerInfo().then(function(e){t.info=e,console.log("INFO: "+JSON.stringify(t.info)),t.pageReady=!0})})},e.prototype.getSensuServer=function(e){return r.b(this,void 0,void 0,function(){var t=this;return r.d(this,function(n){return[2,this.backendSrv.get("api/datasources/"+e).then(function(e){return t.server=e,t.datasourceSrv.get(e.name)})]})})},e.templateUrl="components/server_info/partials/server_info.html",e}()}})});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4uL25vZGVfbW9kdWxlcy90c2xpYi90c2xpYi5lczYuanMiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiYXBwL3BsdWdpbnMvc2RrXCIiLCJ3ZWJwYWNrOi8vL3NyYy9Vc2Vycy9iZ2Fubi9Eb2N1bWVudHMvcmVwb3MtZ3JhZmFuYS1wbHVnaW5zL2dyYWZhbmEtc2Vuc3UtYXBwL3NyYy9tb2R1bGUudHMiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiYXBwL2NvcmUvYXBwX2V2ZW50c1wiIiwid2VicGFjazovLy9zcmMvVXNlcnMvYmdhbm4vRG9jdW1lbnRzL3JlcG9zLWdyYWZhbmEtcGx1Z2lucy9ncmFmYW5hLXNlbnN1LWFwcC9zcmMvY29tcG9uZW50cy9jb25maWcvY29uZmlnLnRzIiwid2VicGFjazovLy9zcmMvVXNlcnMvYmdhbm4vRG9jdW1lbnRzL3JlcG9zLWdyYWZhbmEtcGx1Z2lucy9ncmFmYW5hLXNlbnN1LWFwcC9zcmMvY29tcG9uZW50cy9zZXJ2ZXJzL3NlcnZlcnMudHMiLCJ3ZWJwYWNrOi8vL3NyYy9Vc2Vycy9iZ2Fubi9Eb2N1bWVudHMvcmVwb3MtZ3JhZmFuYS1wbHVnaW5zL2dyYWZhbmEtc2Vuc3UtYXBwL3NyYy9jb21wb25lbnRzL3NlcnZlcl9pbmZvL2luZm8udHMiXSwibmFtZXMiOlsiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsInQiLCJtb2RlIiwiX19lc01vZHVsZSIsIm5zIiwiY3JlYXRlIiwia2V5IiwiYmluZCIsIm4iLCJkZWZhdWx0Iiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiMTciLCJlIiwiX193ZWJwYWNrX2V4cG9ydHNfXyIsIl9fZXh0ZW5kcyIsIl9fYXNzaWduIiwiX19hd2FpdGVyIiwiX19nZW5lcmF0b3IiLCJleHRlbmRTdGF0aWNzIiwiYiIsInNldFByb3RvdHlwZU9mIiwiX19wcm90b19fIiwiQXJyYXkiLCJfXyIsInRoaXMiLCJjb25zdHJ1Y3RvciIsImFzc2lnbiIsImFyZ3VtZW50cyIsImxlbmd0aCIsImFwcGx5IiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJzdGVwIiwibmV4dCIsInJlamVjdGVkIiwidGhyb3ciLCJyZXN1bHQiLCJkb25lIiwidGhlbiIsImJvZHkiLCJmIiwieSIsImciLCJfIiwibGFiZWwiLCJzZW50IiwidHJ5cyIsIm9wcyIsInZlcmIiLCJyZXR1cm4iLCJpdGVyYXRvciIsInYiLCJvcCIsIlR5cGVFcnJvciIsInBvcCIsInB1c2giLCJfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFX18zMl9fIiwiX2NvbXBvbmVudHNfY29uZmlnX2NvbmZpZ19fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9fIiwiU2Vuc3VDb25maWdDdHJsIiwiX2NvbXBvbmVudHNfc2VydmVyc19zZXJ2ZXJzX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8xX18iLCJTZW5zdVNlcnZlcnNDdHJsIiwiX2NvbXBvbmVudHNfc2VydmVyX2luZm9faW5mb19fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMl9fIiwiU2Vuc3VTZXJ2ZXJJbmZvQ3RybCIsImdyYWZhbmFfYXBwX3BsdWdpbnNfc2RrX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8zX18iLCJsb2FkUGx1Z2luQ3NzIiwiZGFyayIsImxpZ2h0IiwiNjkiLCJfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFX182OV9fIiwiJHNjb3BlIiwiJGluamVjdG9yIiwiJHEiLCJlbmFibGVkIiwiYXBwRWRpdEN0cmwiLCJzZXRQb3N0VXBkYXRlSG9vayIsInBvc3RVcGRhdGUiLCJfdGhpcyIsImFwcE1vZGVsIiwiaW1wb3J0RGFzaGJvYXJkcyIsInVybCIsIm1lc3NhZ2UiLCJ0ZW1wbGF0ZVVybCIsIjcxIiwiYmFja2VuZFNydiIsImNvbnRleHRTcnYiLCIkbG9jYXRpb24iLCJpc09yZ0VkaXRvciIsImhhc1JvbGUiLCJkb2N1bWVudCIsInRpdGxlIiwic2VydmVycyIsInBhZ2VSZWFkeSIsImdldFNlbnN1U2VydmVycyIsInNlbGYiLCJmaWx0ZXIiLCJ0eXBlIiwiY29uc29sZSIsImxvZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJjb25maXJtRGVsZXRlIiwiaWQiLCJkZWxldGUiLCJkZWxldGVTZW5zdVNlcnZlciIsInNlcnZlciIsImdyYWZhbmFfYXBwX2NvcmVfYXBwX2V2ZW50c19fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fX2RlZmF1bHQiLCJhIiwiZW1pdCIsInRleHQiLCJ5ZXNUZXh0IiwiaWNvbiIsIm9uQ29uZmlybSIsImFkZFNlbnN1U2VydmVyIiwicGF5bG9hZCIsImFjY2VzcyIsImlzRGVmYXVsdCIsInBvc3QiLCJyZXNwb25zZSIsIl9hIiwiaW5zdGFuY2VJZCIsImRhdGFzb3VyY2UiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsImhyZWYiLCJzZXJ2ZXJJbmZvIiwicGF0aCIsInNlYXJjaCIsIjcyIiwiZGF0YXNvdXJjZVNydiIsImFsZXJ0U3J2IiwiZ2V0U2Vuc3VTZXJ2ZXJJbmZvIiwic2V0IiwiZ2V0U2Vuc3VTZXJ2ZXIiLCJzZXJ2ZXJEUyIsImdldFNlcnZlckluZm8iLCJpbmZvIiwiZHMiXSwibWFwcGluZ3MiOiJrRkFDQSxJQUFBQSxFQUFBLEdBR0EsU0FBQUMsRUFBQUMsR0FHQSxHQUFBRixFQUFBRSxHQUNBLE9BQUFGLEVBQUFFLEdBQUFDLFFBR0EsSUFBQUMsRUFBQUosRUFBQUUsR0FBQSxDQUNB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QWUvQixHQUNqQi9ELEtBQUssU0FBQStGLEdBQ056RCxFQUFLeUQsU0FBV0EsRUFDaEJ6RCxFQUFLeUQsU0FBU0MsZ0JBQWdCaEcsS0FBSyxTQUFDaUcsR0FDbEMzRCxFQUFLMkQsS0FBT0EsRUFDWnZDLFFBQVFDLElBQUksU0FBV0MsS0FBS0MsVUFBVXZCLEVBQUsyRCxPQUMzQzNELEVBQUtlLGtCQUtMN0IsRUFBQTdELFVBQUFtSSxlQUFOLFNBQXFCL0IsbUZBQ25CLFNBQU9uRixLQUFLaUUsV0FBV2xHLElBQUksbUJBQXFCb0gsR0FBSS9ELEtBQUssU0FBQWtHLEdBRXZELE9BREE1RCxFQUFLNEIsT0FBU2dDLEVBQ1A1RCxFQUFLb0QsY0FBYy9JLElBQUl1SixFQUFHN0osY0FuQzlCbUYsRUFBQW1CLFlBQWMsbURBdUN2Qm5CLEVBL0NBIiwiZmlsZSI6Im1vZHVsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSA0MzgpO1xuIiwiLyohICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbkNvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2VcclxudGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGVcclxuTGljZW5zZSBhdCBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuXHJcblRISVMgQ09ERSBJUyBQUk9WSURFRCBPTiBBTiAqQVMgSVMqIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcclxuS0lORCwgRUlUSEVSIEVYUFJFU1MgT1IgSU1QTElFRCwgSU5DTFVESU5HIFdJVEhPVVQgTElNSVRBVElPTiBBTlkgSU1QTElFRFxyXG5XQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgVElUTEUsIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLFxyXG5NRVJDSEFOVEFCTElUWSBPUiBOT04tSU5GUklOR0VNRU5ULlxyXG5cclxuU2VlIHRoZSBBcGFjaGUgVmVyc2lvbiAyLjAgTGljZW5zZSBmb3Igc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zXHJcbmFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKi9cclxuLyogZ2xvYmFsIFJlZmxlY3QsIFByb21pc2UgKi9cclxuXHJcbnZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24oZCwgYikge1xyXG4gICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxyXG4gICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcclxuICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcclxuICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG59O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fZXh0ZW5kcyhkLCBiKSB7XHJcbiAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XHJcbiAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XHJcbn1cclxuXHJcbmV4cG9ydCB2YXIgX19hc3NpZ24gPSBmdW5jdGlvbigpIHtcclxuICAgIF9fYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiBfX2Fzc2lnbih0KSB7XHJcbiAgICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIHMgPSBhcmd1bWVudHNbaV07XHJcbiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSkgdFtwXSA9IHNbcF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIF9fYXNzaWduLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3Jlc3QocywgZSkge1xyXG4gICAgdmFyIHQgPSB7fTtcclxuICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSAmJiBlLmluZGV4T2YocCkgPCAwKVxyXG4gICAgICAgIHRbcF0gPSBzW3BdO1xyXG4gICAgaWYgKHMgIT0gbnVsbCAmJiB0eXBlb2YgT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyA9PT0gXCJmdW5jdGlvblwiKVxyXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBwID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhzKTsgaSA8IHAubGVuZ3RoOyBpKyspIGlmIChlLmluZGV4T2YocFtpXSkgPCAwKVxyXG4gICAgICAgICAgICB0W3BbaV1dID0gc1twW2ldXTtcclxuICAgIHJldHVybiB0O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xyXG4gICAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5kZWNvcmF0ZSA9PT0gXCJmdW5jdGlvblwiKSByID0gUmVmbGVjdC5kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYyk7XHJcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xyXG4gICAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fcGFyYW0ocGFyYW1JbmRleCwgZGVjb3JhdG9yKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCwga2V5KSB7IGRlY29yYXRvcih0YXJnZXQsIGtleSwgcGFyYW1JbmRleCk7IH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fbWV0YWRhdGEobWV0YWRhdGFLZXksIG1ldGFkYXRhVmFsdWUpIHtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5tZXRhZGF0YSA9PT0gXCJmdW5jdGlvblwiKSByZXR1cm4gUmVmbGVjdC5tZXRhZGF0YShtZXRhZGF0YUtleSwgbWV0YWRhdGFWYWx1ZSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2F3YWl0ZXIodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHJlc3VsdC52YWx1ZSk7IH0pLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fZ2VuZXJhdG9yKHRoaXNBcmcsIGJvZHkpIHtcclxuICAgIHZhciBfID0geyBsYWJlbDogMCwgc2VudDogZnVuY3Rpb24oKSB7IGlmICh0WzBdICYgMSkgdGhyb3cgdFsxXTsgcmV0dXJuIHRbMV07IH0sIHRyeXM6IFtdLCBvcHM6IFtdIH0sIGYsIHksIHQsIGc7XHJcbiAgICByZXR1cm4gZyA9IHsgbmV4dDogdmVyYigwKSwgXCJ0aHJvd1wiOiB2ZXJiKDEpLCBcInJldHVyblwiOiB2ZXJiKDIpIH0sIHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiAoZ1tTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzOyB9KSwgZztcclxuICAgIGZ1bmN0aW9uIHZlcmIobikgeyByZXR1cm4gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIHN0ZXAoW24sIHZdKTsgfTsgfVxyXG4gICAgZnVuY3Rpb24gc3RlcChvcCkge1xyXG4gICAgICAgIGlmIChmKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiR2VuZXJhdG9yIGlzIGFscmVhZHkgZXhlY3V0aW5nLlwiKTtcclxuICAgICAgICB3aGlsZSAoXykgdHJ5IHtcclxuICAgICAgICAgICAgaWYgKGYgPSAxLCB5ICYmICh0ID0gb3BbMF0gJiAyID8geVtcInJldHVyblwiXSA6IG9wWzBdID8geVtcInRocm93XCJdIHx8ICgodCA9IHlbXCJyZXR1cm5cIl0pICYmIHQuY2FsbCh5KSwgMCkgOiB5Lm5leHQpICYmICEodCA9IHQuY2FsbCh5LCBvcFsxXSkpLmRvbmUpIHJldHVybiB0O1xyXG4gICAgICAgICAgICBpZiAoeSA9IDAsIHQpIG9wID0gW29wWzBdICYgMiwgdC52YWx1ZV07XHJcbiAgICAgICAgICAgIHN3aXRjaCAob3BbMF0pIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgMDogY2FzZSAxOiB0ID0gb3A7IGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSA0OiBfLmxhYmVsKys7IHJldHVybiB7IHZhbHVlOiBvcFsxXSwgZG9uZTogZmFsc2UgfTtcclxuICAgICAgICAgICAgICAgIGNhc2UgNTogXy5sYWJlbCsrOyB5ID0gb3BbMV07IG9wID0gWzBdOyBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIGNhc2UgNzogb3AgPSBfLm9wcy5wb3AoKTsgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEodCA9IF8udHJ5cywgdCA9IHQubGVuZ3RoID4gMCAmJiB0W3QubGVuZ3RoIC0gMV0pICYmIChvcFswXSA9PT0gNiB8fCBvcFswXSA9PT0gMikpIHsgXyA9IDA7IGNvbnRpbnVlOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSAzICYmICghdCB8fCAob3BbMV0gPiB0WzBdICYmIG9wWzFdIDwgdFszXSkpKSB7IF8ubGFiZWwgPSBvcFsxXTsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDYgJiYgXy5sYWJlbCA8IHRbMV0pIHsgXy5sYWJlbCA9IHRbMV07IHQgPSBvcDsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodCAmJiBfLmxhYmVsIDwgdFsyXSkgeyBfLmxhYmVsID0gdFsyXTsgXy5vcHMucHVzaChvcCk7IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRbMl0pIF8ub3BzLnBvcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIF8udHJ5cy5wb3AoKTsgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgb3AgPSBib2R5LmNhbGwodGhpc0FyZywgXyk7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkgeyBvcCA9IFs2LCBlXTsgeSA9IDA7IH0gZmluYWxseSB7IGYgPSB0ID0gMDsgfVxyXG4gICAgICAgIGlmIChvcFswXSAmIDUpIHRocm93IG9wWzFdOyByZXR1cm4geyB2YWx1ZTogb3BbMF0gPyBvcFsxXSA6IHZvaWQgMCwgZG9uZTogdHJ1ZSB9O1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19leHBvcnRTdGFyKG0sIGV4cG9ydHMpIHtcclxuICAgIGZvciAodmFyIHAgaW4gbSkgaWYgKCFleHBvcnRzLmhhc093blByb3BlcnR5KHApKSBleHBvcnRzW3BdID0gbVtwXTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fdmFsdWVzKG8pIHtcclxuICAgIHZhciBtID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9bU3ltYm9sLml0ZXJhdG9yXSwgaSA9IDA7XHJcbiAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwO1xyXG4gICAgICAgICAgICByZXR1cm4geyB2YWx1ZTogbyAmJiBvW2krK10sIGRvbmU6ICFvIH07XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fcmVhZChvLCBuKSB7XHJcbiAgICB2YXIgbSA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBvW1N5bWJvbC5pdGVyYXRvcl07XHJcbiAgICBpZiAoIW0pIHJldHVybiBvO1xyXG4gICAgdmFyIGkgPSBtLmNhbGwobyksIHIsIGFyID0gW10sIGU7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIHdoaWxlICgobiA9PT0gdm9pZCAwIHx8IG4tLSA+IDApICYmICEociA9IGkubmV4dCgpKS5kb25lKSBhci5wdXNoKHIudmFsdWUpO1xyXG4gICAgfVxyXG4gICAgY2F0Y2ggKGVycm9yKSB7IGUgPSB7IGVycm9yOiBlcnJvciB9OyB9XHJcbiAgICBmaW5hbGx5IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBpZiAociAmJiAhci5kb25lICYmIChtID0gaVtcInJldHVyblwiXSkpIG0uY2FsbChpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZmluYWxseSB7IGlmIChlKSB0aHJvdyBlLmVycm9yOyB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYXI7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3NwcmVhZCgpIHtcclxuICAgIGZvciAodmFyIGFyID0gW10sIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKVxyXG4gICAgICAgIGFyID0gYXIuY29uY2F0KF9fcmVhZChhcmd1bWVudHNbaV0pKTtcclxuICAgIHJldHVybiBhcjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXdhaXQodikge1xyXG4gICAgcmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBfX2F3YWl0ID8gKHRoaXMudiA9IHYsIHRoaXMpIDogbmV3IF9fYXdhaXQodik7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jR2VuZXJhdG9yKHRoaXNBcmcsIF9hcmd1bWVudHMsIGdlbmVyYXRvcikge1xyXG4gICAgaWYgKCFTeW1ib2wuYXN5bmNJdGVyYXRvcikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN5bWJvbC5hc3luY0l0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLlwiKTtcclxuICAgIHZhciBnID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pLCBpLCBxID0gW107XHJcbiAgICByZXR1cm4gaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGk7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgaWYgKGdbbl0pIGlbbl0gPSBmdW5jdGlvbiAodikgeyByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKGEsIGIpIHsgcS5wdXNoKFtuLCB2LCBhLCBiXSkgPiAxIHx8IHJlc3VtZShuLCB2KTsgfSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHJlc3VtZShuLCB2KSB7IHRyeSB7IHN0ZXAoZ1tuXSh2KSk7IH0gY2F0Y2ggKGUpIHsgc2V0dGxlKHFbMF1bM10sIGUpOyB9IH1cclxuICAgIGZ1bmN0aW9uIHN0ZXAocikgeyByLnZhbHVlIGluc3RhbmNlb2YgX19hd2FpdCA/IFByb21pc2UucmVzb2x2ZShyLnZhbHVlLnYpLnRoZW4oZnVsZmlsbCwgcmVqZWN0KSA6IHNldHRsZShxWzBdWzJdLCByKTsgfVxyXG4gICAgZnVuY3Rpb24gZnVsZmlsbCh2YWx1ZSkgeyByZXN1bWUoXCJuZXh0XCIsIHZhbHVlKTsgfVxyXG4gICAgZnVuY3Rpb24gcmVqZWN0KHZhbHVlKSB7IHJlc3VtZShcInRocm93XCIsIHZhbHVlKTsgfVxyXG4gICAgZnVuY3Rpb24gc2V0dGxlKGYsIHYpIHsgaWYgKGYodiksIHEuc2hpZnQoKSwgcS5sZW5ndGgpIHJlc3VtZShxWzBdWzBdLCBxWzBdWzFdKTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hc3luY0RlbGVnYXRvcihvKSB7XHJcbiAgICB2YXIgaSwgcDtcclxuICAgIHJldHVybiBpID0ge30sIHZlcmIoXCJuZXh0XCIpLCB2ZXJiKFwidGhyb3dcIiwgZnVuY3Rpb24gKGUpIHsgdGhyb3cgZTsgfSksIHZlcmIoXCJyZXR1cm5cIiksIGlbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGk7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4sIGYpIHsgaVtuXSA9IG9bbl0gPyBmdW5jdGlvbiAodikgeyByZXR1cm4gKHAgPSAhcCkgPyB7IHZhbHVlOiBfX2F3YWl0KG9bbl0odikpLCBkb25lOiBuID09PSBcInJldHVyblwiIH0gOiBmID8gZih2KSA6IHY7IH0gOiBmOyB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jVmFsdWVzKG8pIHtcclxuICAgIGlmICghU3ltYm9sLmFzeW5jSXRlcmF0b3IpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7XHJcbiAgICB2YXIgbSA9IG9bU3ltYm9sLmFzeW5jSXRlcmF0b3JdLCBpO1xyXG4gICAgcmV0dXJuIG0gPyBtLmNhbGwobykgOiAobyA9IHR5cGVvZiBfX3ZhbHVlcyA9PT0gXCJmdW5jdGlvblwiID8gX192YWx1ZXMobykgOiBvW1N5bWJvbC5pdGVyYXRvcl0oKSwgaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGkpO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IGlbbl0gPSBvW25dICYmIGZ1bmN0aW9uICh2KSB7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7IHYgPSBvW25dKHYpLCBzZXR0bGUocmVzb2x2ZSwgcmVqZWN0LCB2LmRvbmUsIHYudmFsdWUpOyB9KTsgfTsgfVxyXG4gICAgZnVuY3Rpb24gc2V0dGxlKHJlc29sdmUsIHJlamVjdCwgZCwgdikgeyBQcm9taXNlLnJlc29sdmUodikudGhlbihmdW5jdGlvbih2KSB7IHJlc29sdmUoeyB2YWx1ZTogdiwgZG9uZTogZCB9KTsgfSwgcmVqZWN0KTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19tYWtlVGVtcGxhdGVPYmplY3QoY29va2VkLCByYXcpIHtcclxuICAgIGlmIChPYmplY3QuZGVmaW5lUHJvcGVydHkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNvb2tlZCwgXCJyYXdcIiwgeyB2YWx1ZTogcmF3IH0pOyB9IGVsc2UgeyBjb29rZWQucmF3ID0gcmF3OyB9XHJcbiAgICByZXR1cm4gY29va2VkO1xyXG59O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9faW1wb3J0U3Rhcihtb2QpIHtcclxuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XHJcbiAgICB2YXIgcmVzdWx0ID0ge307XHJcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgcmVzdWx0W2tdID0gbW9kW2tdO1xyXG4gICAgcmVzdWx0LmRlZmF1bHQgPSBtb2Q7XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19pbXBvcnREZWZhdWx0KG1vZCkge1xyXG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBkZWZhdWx0OiBtb2QgfTtcclxufVxyXG4iLCJtb2R1bGUuZXhwb3J0cyA9IF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzMyX187IiwiLy8vPHJlZmVyZW5jZSBwYXRoPVwiLi4vbm9kZV9tb2R1bGVzL2dyYWZhbmEtc2RrLW1vY2tzL2FwcC9oZWFkZXJzL2NvbW1vbi5kLnRzXCIgLz5cblxuaW1wb3J0IHtTZW5zdUNvbmZpZ0N0cmx9IGZyb20gXCIuL2NvbXBvbmVudHMvY29uZmlnL2NvbmZpZ1wiO1xuaW1wb3J0IHtTZW5zdVNlcnZlcnNDdHJsfSBmcm9tIFwiLi9jb21wb25lbnRzL3NlcnZlcnMvc2VydmVyc1wiO1xuaW1wb3J0IHtTZW5zdVNlcnZlckluZm9DdHJsfSBmcm9tIFwiLi9jb21wb25lbnRzL3NlcnZlcl9pbmZvL2luZm9cIjtcbmltcG9ydCB7bG9hZFBsdWdpbkNzc30gZnJvbSBcImdyYWZhbmEvYXBwL3BsdWdpbnMvc2RrXCI7XG5cbmxvYWRQbHVnaW5Dc3Moe1xuICBkYXJrOiBcInBsdWdpbnMvZ3JhZmFuYS1zZW5zdS1hcHAvY3NzL3NlbnN1LWFwcC5kYXJrLmNzc1wiLFxuICBsaWdodDogXCJwbHVnaW5zL2dyYWZhbmEtc2Vuc3UtYXBwL2Nzcy9zZW5zdS1hcHAubGlnaHQuY3NzXCJcbn0pO1xuXG5leHBvcnQge1xuICBTZW5zdUNvbmZpZ0N0cmwgYXMgQ29uZmlnQ3RybCxcbiAgU2Vuc3VTZXJ2ZXJJbmZvQ3RybCxcbiAgU2Vuc3VTZXJ2ZXJzQ3RybFxufTtcbiIsIm1vZHVsZS5leHBvcnRzID0gX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fNjlfXzsiLCJcbmV4cG9ydCBjbGFzcyBTZW5zdUNvbmZpZ0N0cmwge1xuICBzdGF0aWMgdGVtcGxhdGVVcmwgPSBcImNvbXBvbmVudHMvY29uZmlnL2NvbmZpZy5odG1sXCI7XG4gIGVuYWJsZWQ6IGJvb2xlYW47XG4gIGFwcEVkaXRDdHJsOiBhbnk7XG4gIGFwcE1vZGVsOiBhbnk7XG5cbiAgLyoqIEBuZ0luamVjdCAqL1xuICBjb25zdHJ1Y3Rvcigkc2NvcGUsICRpbmplY3RvciwgcHJpdmF0ZSAkcSkge1xuICAgIHRoaXMuZW5hYmxlZCA9IGZhbHNlO1xuICAgIHRoaXMuYXBwRWRpdEN0cmwuc2V0UG9zdFVwZGF0ZUhvb2sodGhpcy5wb3N0VXBkYXRlLmJpbmQodGhpcykpO1xuICB9XG5cbiAgcG9zdFVwZGF0ZSgpIHtcbiAgICBpZiAoIXRoaXMuYXBwTW9kZWwuZW5hYmxlZCkge1xuICAgICAgcmV0dXJuIHRoaXMuJHEucmVzb2x2ZSgpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5hcHBFZGl0Q3RybC5pbXBvcnREYXNoYm9hcmRzKCkudGhlbigoKSA9PiB7XG4gICAgICB0aGlzLmVuYWJsZWQgPSB0cnVlO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdXJsOiBcInBsdWdpbnMvZ3JhZmFuYS1zZW5zdS1hcHAvcGFnZS9jb25maWd1cmVcIixcbiAgICAgICAgbWVzc2FnZTogXCJTZW5zdSBBcHAgZW5hYmxlZCFcIlxuICAgICAgfTtcbiAgICB9KTtcbiAgfVxufVxuIiwiXG5pbXBvcnQgYXBwRXZlbnRzIGZyb20gXCJncmFmYW5hL2FwcC9jb3JlL2FwcF9ldmVudHNcIjtcblxuZXhwb3J0IGNsYXNzIFNlbnN1U2VydmVyc0N0cmwge1xuICBzZXJ2ZXI6IGFueTtcbiAgcGFnZVJlYWR5OiBib29sZWFuO1xuICBkYXRhc291cmNlczogW2FueV07XG4gIHNlcnZlcnM6IGFueTtcbiAgaXNPcmdFZGl0b3I6IGJvb2xlYW47XG5cbiAgc3RhdGljIHRlbXBsYXRlVXJsID0gXCJjb21wb25lbnRzL3NlcnZlcnMvcGFydGlhbHMvc2VydmVycy5odG1sXCI7XG5cbiAgLyoqIEBuZ0luamVjdCAqL1xuICBjb25zdHJ1Y3Rvcigkc2NvcGUsICRpbmplY3RvciwgcHJpdmF0ZSBiYWNrZW5kU3J2LCBwcml2YXRlIGNvbnRleHRTcnYsIHByaXZhdGUgJGxvY2F0aW9uKSB7XG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgdGhpcy5pc09yZ0VkaXRvciA9IGNvbnRleHRTcnYuaGFzUm9sZShcIkVkaXRvclwiKSB8fCBjb250ZXh0U3J2Lmhhc1JvbGUoXCJBZG1pblwiKTtcbiAgICBkb2N1bWVudC50aXRsZSA9IFwiR3JhZmFuYSBTZW5zdSBBcHBcIjtcbiAgICB0aGlzLnNlcnZlcnMgPSBbXTtcbiAgICB0aGlzLnBhZ2VSZWFkeSA9IGZhbHNlO1xuICAgIHRoaXMuZ2V0U2Vuc3VTZXJ2ZXJzKCk7XG4gIH1cblxuICBhc3luYyBnZXRTZW5zdVNlcnZlcnMoKSB7XG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgcmV0dXJuIHRoaXMuYmFja2VuZFNydi5nZXQoXCIvYXBpL2RhdGFzb3VyY2VzXCIpXG4gICAgLnRoZW4oKHJlc3VsdDogYW55KSA9PiB7XG4gICAgICBzZWxmLnNlcnZlcnMgPSByZXN1bHQuZmlsdGVyKChvOiB7IHR5cGU6IHt9OyB9KSA9PiB7XG4gICAgICAgIHJldHVybiBvLnR5cGUgPT09IFwiZ3JhZmFuYS1zZW5zdWNvcmUtZGF0YXNvdXJjZVwiO1xuICAgICAgfSk7XG4gICAgICBjb25zb2xlLmxvZyhcInNlcnZlcnMuLi5cIiArIEpTT04uc3RyaW5naWZ5KHNlbGYuc2VydmVycykpO1xuICAgICAgc2VsZi5wYWdlUmVhZHkgPSB0cnVlO1xuICAgIH0pO1xuICB9XG5cbiAgY29uZmlybURlbGV0ZShpZDogYW55KSB7XG4gICAgdGhpcy5iYWNrZW5kU3J2LmRlbGV0ZShcIi9hcGkvZGF0YXNvdXJjZXMvXCIgKyBpZCkudGhlbigoKSA9PiB7XG4gICAgICB0aGlzLmdldFNlbnN1U2VydmVycygpO1xuICAgIH0pO1xuICB9XG5cbiAgZGVsZXRlU2Vuc3VTZXJ2ZXIoc2VydmVyKSB7XG4gICAgYXBwRXZlbnRzLmVtaXQoXCJjb25maXJtLW1vZGFsXCIsIHtcbiAgICAgIHRpdGxlOiBcIkRlbGV0ZVwiLFxuICAgICAgdGV4dDogXCJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIHRoaXMgZGF0YSBzb3VyY2U/XCIsXG4gICAgICB5ZXNUZXh0OiBcIkRlbGV0ZVwiLFxuICAgICAgaWNvbjogXCJmYS10cmFzaFwiLFxuICAgICAgb25Db25maXJtOiAoKSA9PiB7XG4gICAgICAgIHRoaXMuY29uZmlybURlbGV0ZShzZXJ2ZXIuaWQpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLypcbiAgICAxKSBQT1NUIG5ldyBkYXRhc291cmNlXG4gICAgICAgIFBPU1QgdG8gaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS9kYXRhc291cmNlc1xuICAgICAgICB7XG4gICAgICAgICAgXCJuYW1lXCI6XCJTZW5zdSBDb3JlLTJcIixcbiAgICAgICAgICBcInR5cGVcIjpcImdyYWZhbmEtc2Vuc3Vjb3JlLWRhdGFzb3VyY2VcIixcbiAgICAgICAgICBcImFjY2Vzc1wiOlwicHJveHlcIixcbiAgICAgICAgICBcImlzRGVmYXVsdFwiOmZhbHNlXG4gICAgICAgIH1cbiAgICAyKSBHZXQgdGhlIGlkIG9mIHRoZSBjcmVhdGVkIGRhdGFzb3VyY2UgKHdpbGwgYmUgaW4gcmVzcG9uc2UpXG4gICAgICAgIHJlc3BvbnNlLmRhdGFzb3VyY2UuaWRcbiAgICAzKSBTZW5kIHVzZXIgdG8gdGhlIGRhdGFzb3VyY2UgY29uZmlnIHBhZ2UgaHR0cDovL2xvY2FsaG9zdDozMDAwL2RhdGFzb3VyY2VzL2VkaXQvN1xuICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IGRzX2VkaXRvcl91cmk7XG4gICAgICAgIHRoaXMuJGxvY2F0aW9uLnVybCgnL2RhdGFzb3VyY2VzL2VkaXQvNycpO1xuXG4gICAqL1xuICBhc3luYyBhZGRTZW5zdVNlcnZlcigpIHtcbiAgICBjb25zdCBwYXlsb2FkID0ge1xuICAgICAgXCJuYW1lXCI6IFwiU2Vuc3VBcHBDb3JlLVwiICsgdGhpcy5zZXJ2ZXJzLmxlbmd0aCxcbiAgICAgIFwidHlwZVwiOiBcImdyYWZhbmEtc2Vuc3Vjb3JlLWRhdGFzb3VyY2VcIixcbiAgICAgIFwiYWNjZXNzXCI6IFwicHJveHlcIixcbiAgICAgIFwiaXNEZWZhdWx0XCI6IGZhbHNlXG4gICAgfTtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuYmFja2VuZFNydi5wb3N0KFwiL2FwaS9kYXRhc291cmNlc1wiLCBwYXlsb2FkKTtcbiAgICBjb25zdCBpbnN0YW5jZUlkID0gcmVzcG9uc2UuZGF0YXNvdXJjZS5pZDtcbiAgICB0aGlzLiRsb2NhdGlvbi51cmwoJy9wbHVnaW5zL2dyYWZhbmEtc2Vuc3UtYXBwL3BhZ2Uvc2Vuc3Utc2VydmVycycpO1xuICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJy9kYXRhc291cmNlcy9lZGl0LycgKyBpbnN0YW5jZUlkO1xuICB9XG5cbiAgc2VydmVySW5mbyhzZXJ2ZXIpIHtcbiAgICB0aGlzLiRsb2NhdGlvbi5wYXRoKFwicGx1Z2lucy9ncmFmYW5hLXNlbnN1LWFwcC9wYWdlL3NlbnN1LXNlcnZlci1pbmZvXCIpLnNlYXJjaCh7XCJzZXJ2ZXJcIjogc2VydmVyLmlkfSk7XG4gIH1cbn1cbiIsIlxuZXhwb3J0IGNsYXNzIFNlbnN1U2VydmVySW5mb0N0cmwge1xuICBzZXJ2ZXI6IGFueTtcbiAgcGFnZVJlYWR5OiBib29sZWFuO1xuICBkYXRhc291cmNlczogYW55O1xuICBzZXJ2ZXJEUzogYW55O1xuICBpbmZvOiBbXTtcbiAgJHNjb3BlOiBhbnk7XG5cbiAgc3RhdGljIHRlbXBsYXRlVXJsID0gJ2NvbXBvbmVudHMvc2VydmVyX2luZm8vcGFydGlhbHMvc2VydmVyX2luZm8uaHRtbCc7XG5cbiAgLyoqIEBuZ0luamVjdCAqL1xuICBjb25zdHJ1Y3Rvcigkc2NvcGUsICRpbmplY3RvciwgcHJpdmF0ZSBiYWNrZW5kU3J2LCBwcml2YXRlIGRhdGFzb3VyY2VTcnYsIHByaXZhdGUgJHEsIHByaXZhdGUgJGxvY2F0aW9uLCBwcml2YXRlIGFsZXJ0U3J2KSB7XG4gICAgdGhpcy5wYWdlUmVhZHkgPSBmYWxzZTtcbiAgICB0aGlzLiRxID0gJHE7XG4gICAgdGhpcy4kc2NvcGUgPSAkc2NvcGU7XG4gICAgZG9jdW1lbnQudGl0bGUgPSAnR3JhZmFuYSBTZW5zdSBBcHAgLSBJbmZvJztcblxuICAgIHRoaXMuc2VydmVyID0ge307XG5cbiAgICBpZiAoIShcInNlcnZlclwiIGluICRsb2NhdGlvbi5zZWFyY2goKSkpIHtcbiAgICAgIGFsZXJ0U3J2LnNldChcIk5vIFNlbnN1IHNlcnZlciBzcGVjaWZpZWQuXCIsIFwiTm8gU2Vuc3Ugc2VydmVyIHNwZWNpZmllZCBpbiB1cmxcIiwgJ2Vycm9yJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5nZXRTZW5zdVNlcnZlckluZm8oJGxvY2F0aW9uLnNlYXJjaCgpLnNlcnZlcik7XG4gIH1cblxuICAvKiB0aGlzIGlzIHRoZSBzYWZlc3QgbWV0aG9kIHRvIGxvYWQgYXN5bmMgYW5kIHRoZW4gdXBkYXRlICovXG4gIGdldFNlbnN1U2VydmVySW5mbyhpZCkge1xuICAgIHRoaXMuZ2V0U2Vuc3VTZXJ2ZXIoaWQpXG4gICAgICAudGhlbihzZXJ2ZXJEUyA9PiB7XG4gICAgICB0aGlzLnNlcnZlckRTID0gc2VydmVyRFM7XG4gICAgICB0aGlzLnNlcnZlckRTLmdldFNlcnZlckluZm8oKS50aGVuKChpbmZvKSA9PiB7XG4gICAgICAgIHRoaXMuaW5mbyA9IGluZm87XG4gICAgICAgIGNvbnNvbGUubG9nKFwiSU5GTzogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmluZm8pKTtcbiAgICAgICAgdGhpcy5wYWdlUmVhZHkgPSB0cnVlO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBnZXRTZW5zdVNlcnZlcihpZDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuYmFja2VuZFNydi5nZXQoJ2FwaS9kYXRhc291cmNlcy8nICsgaWQpLnRoZW4oZHMgPT4ge1xuICAgICAgdGhpcy5zZXJ2ZXIgPSBkcztcbiAgICAgIHJldHVybiB0aGlzLmRhdGFzb3VyY2VTcnYuZ2V0KGRzLm5hbWUpO1xuICAgIH0pO1xuICB9XG5cbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=